# 🔧 Render Deployment Troubleshooting Guide

## ❌ **Current Issue Fixed:**
```
chmod: cannot access 'build.sh': No such file or directory
==> Build failed 😞
```

## ✅ **Solution Applied:**

### **1. Updated render.yaml**
Replaced external script dependency with inline build commands:

```yaml
buildCommand: |
  echo "🚀 Starting ReWear build process..."
  pip install --upgrade pip setuptools wheel
  pip install -r requirements.txt
  echo "🔍 Verifying gunicorn installation..."
  which gunicorn
  gunicorn --version
  echo "🏁 Running startup script..."
  python startup.py
  echo "✅ Build completed successfully!"
```

### **2. Updated startCommand**
```yaml
startCommand: python startup.py && gunicorn app:app --bind 0.0.0.0:$PORT --workers 1 --timeout 120
```

---

## 🚀 **Deployment Options**

### **Option 1: Use Updated render.yaml (Recommended)**
The main `render.yaml` file has been updated with inline commands that don't depend on external scripts.

### **Option 2: Use render-simple.yaml**
A simplified version with basic build commands:
```bash
# Rename the file in your repository
mv render-simple.yaml render.yaml
```

### **Option 3: Manual Environment Setup**
If automated deployment fails, set these manually in Render dashboard:

**Build Command:**
```bash
pip install --upgrade pip && pip install -r requirements.txt
```

**Start Command:**
```bash
python startup.py && gunicorn app:app --bind 0.0.0.0:$PORT --workers 1 --timeout 120
```

---

## 🔍 **Debugging Steps**

### **1. Check Build Logs**
In Render dashboard:
1. Go to your service
2. Click "Logs" tab
3. Look for specific error messages

### **2. Verify File Structure**
Ensure these files are in your repository root:
- ✅ `app.py`
- ✅ `requirements.txt`
- ✅ `render.yaml`
- ✅ `Procfile`
- ✅ `startup.py`
- ✅ `database.py`

### **3. Test Locally**
Before deploying, test the exact commands locally:

```bash
# Test build process
pip install --upgrade pip setuptools wheel
pip install -r requirements.txt

# Test startup script
python startup.py

# Test gunicorn
gunicorn app:app --bind 0.0.0.0:5000 --workers 1 --timeout 120
```

---

## 🛠️ **Alternative Deployment Methods**

### **Method 1: Direct Python (Fallback)**
If gunicorn continues to fail:

**Start Command:**
```bash
python app.py
```

**Update app.py** to bind to correct port:
```python
if __name__ == '__main__':
    port = int(os.environ.get('PORT', 5000))
    app.run(host='0.0.0.0', port=port, debug=False)
```

### **Method 2: Waitress WSGI Server**
Add to requirements.txt:
```
waitress==2.1.2
```

**Start Command:**
```bash
waitress-serve --host=0.0.0.0 --port=$PORT app:app
```

### **Method 3: Flask Development Server**
**Start Command:**
```bash
flask run --host=0.0.0.0 --port=$PORT
```

---

## 📋 **Environment Variables Checklist**

Ensure these are set in Render dashboard:

- ✅ `DATABASE_URL` - MongoDB connection string
- ✅ `SECRET_KEY` - Auto-generated by Render
- ✅ `FLASK_ENV` - Set to "production"
- ✅ `MAIL_SERVER` - smtp.gmail.com
- ✅ `MAIL_PORT` - 587
- ✅ `MAIL_USE_TLS` - "True"
- ✅ `MAIL_USE_SSL` - "False"
- ✅ `MAIL_USERNAME` - mkbharvad534@gmail.com
- ✅ `MAIL_PASSWORD` - dwtp fmiq miyl ccvq
- ✅ `MAIL_DEFAULT_SENDER` - mkbharvad534@gmail.com
- ✅ `UPLOAD_FOLDER` - static/uploads
- ✅ `MAX_CONTENT_LENGTH` - 16777216

---

## 🔄 **Step-by-Step Deployment**

### **1. Prepare Repository**
```bash
# Ensure all files are committed
git add .
git commit -m "Fix Render deployment configuration"
git push origin main
```

### **2. Deploy to Render**
1. Connect your GitHub repository
2. Select "Web Service"
3. Use these settings:
   - **Environment**: Python
   - **Build Command**: (Use from render.yaml)
   - **Start Command**: (Use from render.yaml)
   - **Plan**: Free

### **3. Monitor Deployment**
1. Watch build logs for errors
2. Check application logs after deployment
3. Test the live URL

---

## 🆘 **Common Issues & Solutions**

### **Issue: "Module not found"**
**Solution:** Check requirements.txt has all dependencies

### **Issue: "Port already in use"**
**Solution:** Ensure app binds to `$PORT` environment variable

### **Issue: "MongoDB connection failed"**
**Solution:** Verify DATABASE_URL is correctly set

### **Issue: "Static files not loading"**
**Solution:** Check UPLOAD_FOLDER path and file permissions

---

## ✅ **Expected Success Output**

```
🚀 Starting ReWear build process...
Successfully installed Flask-3.0.0 gunicorn-21.2.0 pymongo-4.6.0 ...
🔍 Verifying gunicorn installation...
/opt/render/project/src/.venv/bin/gunicorn
gunicorn (version 21.2.0)
🏁 Running startup script...
✅ Connected to MongoDB successfully!
Created directory: static/uploads
Admin user already exists in MongoDB
Startup script completed!
✅ Build completed successfully!

==> Build successful 🎉
==> Deploying...
==> Running 'python startup.py && gunicorn app:app --bind 0.0.0.0:$PORT --workers 1 --timeout 120'
✅ Connected to MongoDB successfully!
[INFO] Starting gunicorn 21.2.0
[INFO] Listening at: http://0.0.0.0:10000
[INFO] Using worker: sync
[INFO] Booted in 2.34s
```

---

## 🎯 **Next Steps After Successful Deployment**

1. ✅ **Test the live application**
2. ✅ **Login with admin credentials**
3. ✅ **Verify MongoDB connectivity**
4. ✅ **Test all dashboard features**
5. ✅ **Upload a test item**
6. ✅ **Check email notifications**

---

## 📞 **Support Resources**

- **Render Documentation**: https://render.com/docs
- **Build Troubleshooting**: https://render.com/docs/troubleshooting-deploys
- **Python Deployment**: https://render.com/docs/deploy-flask

**Your ReWear application should now deploy successfully! 🎉**
