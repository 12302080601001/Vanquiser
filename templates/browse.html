{% extends "base.html" %}

{% block title %}Browse Items - ReWear{% endblock %}

{% block content %}
<div class="container mt-5 pt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-primary text-white">
                <div class="card-body text-center p-4">
                    <h2 class="fw-bold mb-2">Discover Sustainable Fashion</h2>
                    <p class="mb-0 opacity-75">Browse through thousands of pre-loved items waiting for a new home</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Search and Filters -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <form method="GET" class="row g-3">
                        <div class="col-md-6">
                            <label for="search" class="form-label fw-semibold">
                                <i class="fas fa-search me-2"></i>Search Items
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="search" 
                                   name="search" 
                                   value="{{ search }}" 
                                   placeholder="Search by title or description...">
                        </div>
                        <div class="col-md-4">
                            <label for="category" class="form-label fw-semibold">
                                <i class="fas fa-filter me-2"></i>Category
                            </label>
                            <select class="form-select" id="category" name="category">
                                <option value="">All Categories</option>
                                <option value="tops" {{ 'selected' if category == 'tops' }}>Tops</option>
                                <option value="bottoms" {{ 'selected' if category == 'bottoms' }}>Bottoms</option>
                                <option value="dresses" {{ 'selected' if category == 'dresses' }}>Dresses</option>
                                <option value="outerwear" {{ 'selected' if category == 'outerwear' }}>Outerwear</option>
                                <option value="shoes" {{ 'selected' if category == 'shoes' }}>Shoes</option>
                                <option value="accessories" {{ 'selected' if category == 'accessories' }}>Accessories</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-search me-1"></i>Search
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Category Quick Filters -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex flex-wrap gap-2 justify-content-center">
                <a href="{{ url_for('browse') }}" 
                   class="btn btn-outline-primary {{ 'active' if not category }}">
                    <i class="fas fa-th-large me-1"></i>All Items
                </a>
                <a href="{{ url_for('browse', category='tops') }}" 
                   class="btn btn-outline-primary {{ 'active' if category == 'tops' }}">
                    <i class="fas fa-tshirt me-1"></i>Tops
                </a>
                <a href="{{ url_for('browse', category='bottoms') }}" 
                   class="btn btn-outline-primary {{ 'active' if category == 'bottoms' }}">
                    <i class="fas fa-user-tie me-1"></i>Bottoms
                </a>
                <a href="{{ url_for('browse', category='dresses') }}" 
                   class="btn btn-outline-primary {{ 'active' if category == 'dresses' }}">
                    <i class="fas fa-female me-1"></i>Dresses
                </a>
                <a href="{{ url_for('browse', category='outerwear') }}" 
                   class="btn btn-outline-primary {{ 'active' if category == 'outerwear' }}">
                    <i class="fas fa-coat-arms me-1"></i>Outerwear
                </a>
                <a href="{{ url_for('browse', category='shoes') }}" 
                   class="btn btn-outline-primary {{ 'active' if category == 'shoes' }}">
                    <i class="fas fa-shoe-prints me-1"></i>Shoes
                </a>
                <a href="{{ url_for('browse', category='accessories') }}" 
                   class="btn btn-outline-primary {{ 'active' if category == 'accessories' }}">
                    <i class="fas fa-gem me-1"></i>Accessories
                </a>
            </div>
        </div>
    </div>
    
    <!-- Results Info -->
    {% if search or category %}
    <div class="row mb-3">
        <div class="col-12">
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                Showing {{ items|length }} result(s)
                {% if search %}for "<strong>{{ search }}</strong>"{% endif %}
                {% if category %}in category "<strong>{{ category.title() }}</strong>"{% endif %}
                <a href="{{ url_for('browse') }}" class="btn btn-sm btn-outline-info ms-2">
                    <i class="fas fa-times me-1"></i>Clear Filters
                </a>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Items Grid -->
    <div class="row">
        {% if items %}
            {% for item in items %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card item-card h-100">
                    <img src="{{ url_for('static', filename=item.image.replace('static/', '')) }}"
                         class="item-image"
                         alt="{{ item.title }}"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="item-image-placeholder" style="display: none; height: 200px; background: #f8f9fa; border: 2px dashed #dee2e6; align-items: center; justify-content: center; flex-direction: column; color: #6c757d;">
                        <i class="fas fa-image fa-3x mb-2"></i>
                        <span>No Image</span>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title fw-bold">{{ item.title }}</h6>
                            <span class="badge points-badge">{{ item.points_value }} pts</span>
                        </div>
                        <p class="card-text text-muted small flex-grow-1">
                            {{ item.description[:100] }}{% if item.description|length > 100 %}...{% endif %}
                        </p>
                        <div class="row mb-3">
                            <div class="col-6">
                                <small class="text-muted">
                                    <i class="fas fa-tag me-1"></i>{{ item.category.title() }}
                                </small>
                            </div>
                            <div class="col-6">
                                <small class="text-muted">
                                    <i class="fas fa-ruler me-1"></i>{{ item.size }}
                                </small>
                            </div>
                            <div class="col-6 mt-1">
                                <small class="text-muted">
                                    <i class="fas fa-star me-1"></i>{{ item.condition.title() }}
                                </small>
                            </div>
                            <div class="col-6 mt-1">
                                <small class="text-muted">
                                    <i class="fas fa-clock me-1"></i>{{ item.created_at[:10] }}
                                </small>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mt-auto">
                            <span class="badge status-{{ item.status }}">
                                <i class="fas fa-{{ 'check' if item.status == 'available' else 'times' }} me-1"></i>
                                {{ item.status.title() }}
                            </span>
                            <div class="btn-group btn-group-sm">
                                <a href="{{ url_for('item_detail', item_id=item.id) }}" 
                                   class="btn btn-primary">
                                    <i class="fas fa-eye me-1"></i>View
                                </a>
                                {% if item.status == 'available' and session.user_id and item.user_id != session.user_id %}
                                <a href="{{ url_for('request_exchange', item_id=item.id) }}" 
                                   class="btn btn-success">
                                    <i class="fas fa-exchange-alt me-1"></i>Exchange
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
        <div class="col-12">
            <div class="text-center py-5">
                <i class="fas fa-search fa-4x text-muted mb-3"></i>
                <h4 class="text-muted">No items found</h4>
                <p class="text-muted">
                    {% if search or category %}
                        Try adjusting your search criteria or browse all items.
                    {% else %}
                        Be the first to upload an item to our marketplace!
                    {% endif %}
                </p>
                <div class="d-flex gap-2 justify-content-center flex-wrap">
                    {% if search or category %}
                    <a href="{{ url_for('browse') }}" class="btn btn-primary">
                        <i class="fas fa-th-large me-2"></i>Browse All Items
                    </a>
                    {% endif %}
                    {% if session.user_id %}
                    <a href="{{ url_for('upload_item') }}" class="btn btn-success">
                        <i class="fas fa-plus me-2"></i>Upload Item
                    </a>
                    {% else %}
                    <a href="{{ url_for('register') }}" class="btn btn-success">
                        <i class="fas fa-user-plus me-2"></i>Join ReWear
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Load More Button (for future pagination) -->
    {% if items and items|length >= 12 %}
    <div class="row mt-4">
        <div class="col-12 text-center">
            <button class="btn btn-outline-primary btn-lg" onclick="loadMoreItems()">
                <i class="fas fa-plus me-2"></i>Load More Items
            </button>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Add animation to items
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    // Observe all item cards
    document.querySelectorAll('.item-card').forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = `opacity 0.6s ease ${index * 0.1}s, transform 0.6s ease ${index * 0.1}s`;
        observer.observe(card);
    });
    
    // Search functionality
    document.getElementById('search').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            this.form.submit();
        }
    });
    
    // Load more items (placeholder function)
    function loadMoreItems() {
        alert('Load more functionality will be implemented with pagination in the next version.');
    }
    
    // Add hover effects
    document.querySelectorAll('.item-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });
    
    // Filter button animations
    document.querySelectorAll('.btn-outline-primary').forEach(btn => {
        btn.addEventListener('click', function() {
            // Add loading animation
            if (!this.classList.contains('active')) {
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Loading...';
                
                setTimeout(() => {
                    this.innerHTML = originalText;
                }, 1000);
            }
        });
    });
</script>

<style>
    .bg-gradient-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .item-card {
        transition: all 0.3s ease;
        border-radius: 15px;
        overflow: hidden;
        border: none;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }
    
    .item-card:hover {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }
    
    .item-image {
        height: 220px;
        object-fit: cover;
        width: 100%;
        transition: transform 0.3s ease;
    }
    
    .item-card:hover .item-image {
        transform: scale(1.05);
    }
    
    .btn-outline-primary.active {
        background: linear-gradient(45deg, #667eea, #764ba2);
        border-color: #667eea;
        color: white;
    }
    
    .points-badge {
        background: linear-gradient(45deg, #ff9a9e, #fecfef);
        color: #333;
        font-weight: 600;
        border-radius: 20px;
        padding: 5px 12px;
    }
    
    .status-available {
        background: linear-gradient(45deg, #a8edea, #fed6e3);
        color: #333;
    }
    
    .status-exchanged {
        background: linear-gradient(45deg, #ffecd2, #fcb69f);
        color: #333;
    }
    
    @media (max-width: 768px) {
        .item-image {
            height: 180px;
        }
        
        .btn-group-sm .btn {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
    }
</style>
{% endblock %}
